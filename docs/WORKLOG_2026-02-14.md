# WORKLOG 2026-02-14

## [MIGRATION] CHANGELOG 상세 이력 이관
- 아래 내용은 기존 `docs/CHANGELOG_2026-02-14.md`의 상세 기록 원문을 보존하기 위해 이관한 것입니다.
- 향후 상세 실행 이력은 WORKLOG에, 최종 요약은 CHANGELOG에 기록합니다.

---

# CHANGELOG 2026-02-14

## [TIME] 23:17 (KST) — [START] 스케줄 설정 API 프론트 연동

### 작업 목표 요약
- 스케줄 설정 다이얼로그가 백엔드 스케줄 조회/수정 API와 정상 통신하도록 연결한다.
- 현재 연결 오류(잘못된 경로/중복 호출)와 편집 UX의 기본값 고정 문제를 정리한다.

## [TIME] 23:17 (KST) — [PLAN] 스케줄 설정 API 프론트 연동

### 실행 계획
# 🧠 실행 계획 보고

## 0. 이동할 브랜치
- 기준 브랜치: `master`
- 이동 예정 브랜치: `feature/schedule-api-frontend-connect`
- 현재 워크트리가 대규모 변경 상태이므로, 승인 후 브랜치 생성/이동 시 사용자와 기준 브랜치(`master`)를 다시 확인한 뒤 진행

## 1. 작업 목표
- 스케줄 설정 UI(`ScheduleDialog`)를 스케줄 API(`/api/admin/schedule/list`, `/api/admin/schedule/update`)에 안정적으로 연결
- 조회/저장 실패 없이 동작하도록 프론트 호출부와 요청 DTO를 정리

## 2. 현재 상태 분석
- 관련 파일
  - `src/moneylog/src/api/queries.ts`
  - `src/moneylog/src/components/ScheduleDialog.tsx`
  - `src/moneylog/src/types/schedule.ts`
  - (확인용) `src/main/java/com/moneylog_backend/moneylog/schedule/controller/ScheduleController.java`
  - (확인용) `src/main/java/com/moneylog_backend/moneylog/schedule/dto/ScheduleReqDto.java`
- 현재 로직 요약
  - `useSchedules`가 `/account/schedule/list`와 `/admin/schedule/list`를 연속 호출하고 있음
  - 첫 호출 실패 시 두 번째 호출이 실행되지 않아 조회가 깨질 수 있음
  - 편집 시작 시 실제 크론 값을 해석하지 않고 DAILY/03:00 기본값을 강제 세팅
- 문제 원인
  - 스케줄 API 경로 정리 과정에서 임시 코드가 남아 중복/오류 호출이 발생
  - 응답 DTO가 `cronExpression` 중심이라 프론트 편집 상태 초기화 로직이 미완성

## 3. 변경 예정 파일 목록
- `src/moneylog/src/api/queries.ts`
- `src/moneylog/src/components/ScheduleDialog.tsx`
- `src/moneylog/src/types/schedule.ts` (필요 시)
- `docs/CHANGELOG_2026-02-14.md` (계획/승인/수행/검증 기록)

## 4. 변경 전략
- 1차(필수): API 호출 경로를 단일/정상 경로로 정리하고 에러 처리 일관화
- 2차(필수): 다이얼로그 저장 payload가 백엔드 `ScheduleReqDto` 제약(`frequency`, `time`, `dayOfWeek`, `dayOfMonth`)을 항상 만족하도록 보정
- 3차(개선): `cronExpression` 기반 편집 초기값 파싱 유틸 추가(가능 범위 내)
- 대안 비교
  - 대안 A: 파싱 없이 기본값 유지(개발 빠름, UX/정확도 낮음)
  - 대안 B: 단순 크론 파싱 추가(구현량 소폭 증가, 실제 설정값 반영 가능) -> 우선 채택

## 5. 예상 영향 범위
- 프론트 스케줄 설정 화면/React Query 캐시(`schedules`) 동작에 영향
- 인증/권한 영향 가능성: `/api/admin/schedule/**` 접근 시 사용자 권한 정책에 따라 403 발생 가능 (백엔드 정책 확인 필요)
- DB 스키마/외부 연동/빌드 설정 영향 없음

## 6. 리스크 분석
- 실패 가능성
  - 크론 파싱 규칙이 백엔드 생성 규칙과 다르면 초기값 매핑이 틀릴 수 있음
  - 권한 정책으로 실사용 계정에서 API가 차단될 수 있음
- 롤백 방법
  - `queries.ts`, `ScheduleDialog.tsx` 변경분을 파일 단위로 되돌리면 즉시 복구 가능

## 7. 테스트 계획
- 프론트 수동 검증
  - 스케줄 목록 조회 성공/실패 토스트 확인
  - DAILY/WEEKLY/MONTHLY 각각 저장 요청 payload 확인
  - 저장 후 목록 재조회(invalidate) 확인
- 빌드 검증
  - 프로젝트 루트: `./gradlew`
  - 필요 시: `./gradlew build`
  - 프론트 디렉토리(`src/moneylog`): `npm run build` (환경 허용 시)
- 새로운 테스트 추가 여부
  - 이번 작업은 우선 연결 안정화 중심으로, 별도 테스트 코드는 미추가 예정
### 승인 여부
- 승인 완료 (사용자 응답: "진행해")
- 승인 시간: 23:20

## [TIME] 23:20 (KST) — [START] 승인 후 구현 시작

### PRE-FLIGHT
- 현재 브랜치: `master`
- 기준 브랜치 확인: `master` 기준 작업 진행
- 현재 워크트리: 기존 변경 다수 존재, 요청 범위 파일만 최소 수정
## [TIME] 23:22 (KST) — [IMPLEMENT] 스케줄 API 경로 정리 및 다이얼로그 편집값 동기화

### 수행 내용
- `src/moneylog/src/api/queryClient.ts`
  - `queryKeys.schedules` 상수 추가로 스케줄 쿼리 키 통일
- `src/moneylog/src/api/queries.ts`
  - `useSchedules` 중복 호출 제거 (`/admin/schedule/list` 단일 호출)
  - `useUpdateSchedule` invalidate 키를 상수(`queryKeys.schedules`)로 통일
- `src/moneylog/src/types/schedule.ts`
  - `ScheduleFrequency` 타입 도입
  - `Schedule.description`을 `string | null`로 보정
- `src/moneylog/src/components/ScheduleDialog.tsx`
  - `cronExpression` 파싱 로직 추가(DAILY/WEEKLY/MONTHLY)
  - 편집 진입 시 실제 크론 기반으로 `frequency/time/day` 초기값 세팅
  - 저장 전 요일(1~7), 매월 실행일(1~31) 유효성 체크 추가
  - `Select` 변경 타입을 `ScheduleFrequency`로 명확화

### 영향 범위
- 스케줄 조회/수정 API 호출 안정성
- 스케줄 편집 UX(기존 값 반영 정확도)
### VERIFY
- 루트에서 `./gradlew` 실행
  - 결과: 성공 (`:help`, `BUILD SUCCESSFUL`)
- 루트에서 `./gradlew build` 실행
  - 결과: 실패
  - 실패 핵심 로그
    - `MoneyLogApplicationTests > contextLoads() FAILED`
    - `IllegalStateException` -> `BeanCreationException` -> `ServiceException` -> `HibernateException at DialectFactoryImpl.java:191`
  - 재현 방법: 프로젝트 루트에서 `./gradlew build`
  - 해결 시도/결과: 단일 재실행 기준 동일 테스트 실패로 종료
- 프론트에서 `npm run build` 실행 (`src/moneylog`)
  - 결과: 실패
  - 실패 핵심 로그
    - `sh: 1: vite: not found`
  - 재현 방법: `src/moneylog` 디렉토리에서 `npm run build`
  - 원인 추정: 로컬 의존성/실행 환경 미설치 상태

# 📊 계획 대비 수행 결과 비교

## 계획 대비 차이
- 계획한 범위(`queries.ts`, `ScheduleDialog.tsx`, `types/schedule.ts`) 내에서 구현했고, 쿼리 키 일관화를 위해 `queryClient.ts`를 추가로 소규모 수정함.

## 추가 발생 이슈
- 백엔드 통합 테스트(`contextLoads`) 기존 환경 이슈로 `./gradlew build` 실패.
- 프론트 빌드는 `vite` 실행 파일 부재로 실패.

## 계획 외 수정 사항
- `src/moneylog/src/api/queryClient.ts`에 `queryKeys.schedules` 상수 추가.

## [TIME] 23:54 (KST) — [PLAN] ScheduleDialog parseCronExpression 외부 분리 리팩터링

### 실행 계획
# 🧠 실행 계획 보고

## 0. 이동할 브랜치
- 현재 브랜치 유지: `feature/schedule-api-frontend-connect`
- 이번 작업은 브랜치 생성/이동 없이 현재 브랜치에서 최소 범위 수정

## 1. 작업 목표
- `ScheduleDialog` 내부의 `parseCronExpression`를 컴포넌트 외부로 이동
- 렌더링마다 함수가 재생성되지 않도록 구조 정리

## 2. 현재 상태 분석
- 관련 파일
  - `src/moneylog/src/components/ScheduleDialog.tsx`
  - `docs/CHANGELOG_2026-02-14.md`
- 현재 로직 요약
  - `parseCronExpression`가 컴포넌트 내부에 선언되어 있고 `handleEditClick`에서 호출됨
- 문제 원인
  - 함수가 상태/props 비의존 순수 함수임에도 컴포넌트 내부 선언으로 불필요한 재생성 발생

## 3. 변경 예정 파일 목록
- `src/moneylog/src/components/ScheduleDialog.tsx`
- `docs/CHANGELOG_2026-02-14.md`

## 4. 변경 전략
- `parseCronExpression` 타입 별칭(`ParsedCronExpression`)과 함께 컴포넌트 외부(파일 상단)로 이동
- 내부 호출부(`handleEditClick`)는 기존 함수명 그대로 재사용
- 대안
  - 별도 유틸 파일 분리: 재사용성은 높지만 현재 요구(최소 범위) 대비 변경폭 증가

## 5. 예상 영향 범위
- 프론트 컴포넌트 내부 구조/가독성에만 영향
- API/인증/DB/외부연동/빌드 설정 영향 없음

## 6. 리스크 분석
- 실패 가능성
  - 타입 누락 또는 함수 스코프 이동 중 참조 오류
- 롤백 방법
  - `ScheduleDialog.tsx`의 해당 이동 변경만 되돌리면 즉시 복구 가능

## 7. 테스트 계획
- 최소 검증: 프로젝트 루트에서 `./gradlew`
- 추가 테스트 코드 작성 없음 (기능 로직 불변 리팩터링)

### 승인 여부
- 승인 완료 (사용자 응답: "지금 브랜치에서 최소 범위로 수장가자")
- 승인 시간: 23:54

## [TIME] 23:54 (KST) — [START] parseCronExpression 외부 분리 구현 시작

### PRE-FLIGHT
- 현재 브랜치: `feature/schedule-api-frontend-connect`
- 현재 워크트리: 기존 변경 다수 존재, 요청 파일 최소 범위 수정 원칙 적용

## [TIME] 23:54 (KST) — [IMPLEMENT] ScheduleDialog 순수 함수 외부 이동

### 수행 내용
- `src/moneylog/src/components/ScheduleDialog.tsx`
  - `ParsedCronExpression` 타입 별칭 추가
  - `parseCronExpression`를 컴포넌트 바깥으로 이동
  - 컴포넌트 내부 중복 선언 제거
  - `handleEditClick` 호출 로직은 동일하게 유지

### 영향 범위
- `ScheduleDialog` 파일 내부 구조 개선(함수 재생성 방지/가독성 향상)
- 동작 로직 변화 없음

### VERIFY
- 루트에서 `./gradlew` 실행
  - 결과: 성공 (`:help`, `BUILD SUCCESSFUL`)

# 📊 계획 대비 수행 결과 비교

## 계획 대비 차이
- 계획과 동일하게 `ScheduleDialog.tsx` 단일 파일만 코드 수정함.

## 추가 발생 이슈
- 없음.

## 계획 외 수정 사항
- 없음.
