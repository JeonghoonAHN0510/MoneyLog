# WORKLOG 2026-02-15

## [TIME] 15:06 (KST) — [PLAN] Validation 커스텀 메시지 우선순위 회귀 수정

### 실행 계획
# 🧠 실행 계획 보고

## 0. 이동할 브랜치
- 현재 브랜치 유지: `fix/validation-error-message-format`

## 1. 작업 목표
- 애노테이션에 명시된 커스텀 메시지(`@NotBlank(message="...")`)를 우선적으로 반환
- 프레임워크 기본 메시지일 때만 제약코드 기반 커스텀 메시지로 대체

## 2. 현재 상태 분석
- 관련 파일
  - `src/main/java/com/moneylog_backend/global/exception/GlobalExceptionHandler.java`
- 현재 로직 요약
  - `isKnownConstraintCode(fieldError)`가 true면 무조건 `getFieldSpecificValidationMessage` 사용
  - 이로 인해 `jobName` 같은 커스텀 메시지가 일반 메시지로 덮임
- 문제 원인
  - `defaultMessage` 우선순위가 제약코드 분기보다 뒤에 배치됨

## 3. 변경 예정 파일 목록
- `src/main/java/com/moneylog_backend/global/exception/GlobalExceptionHandler.java`
- `docs/WORKLOG_2026-02-15.md`
- `docs/CHANGELOG_2026-02-15.md`

## 4. 변경 전략
- 1차: `resolveValidationMessage` 우선순위를 다음 순서로 재정렬
  - (a) `defaultMessage` 존재 시 우선 반환
  - (b) 단, 기본 메시지 템플릿으로 판단되는 경우만 제약코드 기반 커스텀 생성
  - (c) 기본/커스텀 모두 없으면 field fallback
- 2차: 기본 메시지 판별은 문자열 하드코딩이 아닌 `fieldError.getCodes()` + `defaultMessage` 패턴 최소 검증으로 안전 분기
- 3차: `./gradlew` 실행으로 컴파일 검증 (`./gradlew test` 제외)

## 5. 예상 영향 범위
- 영향 있음: validation 에러 메시지 선택 우선순위
- 영향 없음: HTTP 상태코드/에러코드/비즈니스 로직

## 6. 리스크 분석
- 실패 가능성
  - 기본 메시지 판별 기준이 과하거나 부족하면 일부 케이스 메시지 품질 저하 가능
- 완화
  - 커스텀 메시지 우선 원칙을 확실히 보장하고, 나머지는 현재 fallback 유지
- 롤백 방법
  - `GlobalExceptionHandler` 해당 메서드 원복

## 7. 테스트 계획
- `./gradlew`
- 수동 확인: `ScheduleReqDto.jobName` 공백 요청 시 "Job Name은 필수입니다" 유지 확인

### 승인 여부
- 승인 완료 (사용자 응답: "진행하자")
- 승인 시간: 15:07

## [TIME] 15:07 (KST) — [START] Validation 커스텀 메시지 우선순위 회귀 수정 구현 시작

## [TIME] 15:08 (KST) — [IMPLEMENT] Validation 커스텀 메시지 우선순위 보장 로직 수정

### 수행 내용
- 파일: `src/main/java/com/moneylog_backend/global/exception/GlobalExceptionHandler.java`
- 변경
  - `resolveValidationMessage` 우선순위 재정렬
  - 기존: `isKnownConstraintCode` true면 즉시 일반화 메시지 생성
  - 변경: `defaultMessage`가 존재하면 무조건 우선 반환
  - `defaultMessage`가 비어 있을 때만 `getFieldSpecificValidationMessage` 경로로 진입
- 효과
  - `@NotBlank(message = "Job Name은 필수입니다")` 같은 명시 커스텀 메시지가 더 이상 일반 메시지로 덮어써지지 않음

### VERIFY
- 루트에서 `./gradlew` 실행
  - 결과: 성공 (`BUILD SUCCESSFUL`)
- 사용자 요청에 따라 `./gradlew test`는 실행하지 않음

# 📊 계획 대비 수행 결과 비교

## 계획 대비 차이
- 계획과 동일하게 단일 메서드 우선순위 수정으로 완료

## 추가 발생 이슈
- 없음

## 계획 외 수정 사항
- 없음
