# PLAN_2026-02-26

## PROPOSED-PLAN
- 목표: 로컬/AWS 이중 프로필 파일 업로드 구조 구현
- 범위: 저장소 추상화(local/s3), 공용 업로드 API 추가, application.yml(AWS)/application-local.yml(로컬) 분리, 기존 `/uploads/...` 하위호환 유지

## ASSUMPTIONS
- AWS 버킷은 private 정책으로 운영한다.
- AWS 자격증명은 런타임 환경(Env/Role)에서 주입한다.
- 기존 DB에 저장된 `/uploads/...` URL은 계속 유효해야 한다.

## DECISIONS
- 기본 스토리지는 `application.yml`에서 `s3`를 사용한다.
- 로컬 개발은 `application-local.yml`에서 `local`로 override 한다.
- 다운로드는 local은 stream 응답, s3는 presigned URL redirect를 사용한다.

## SCOPE-IN
- `FileStorage` 인터페이스 및 `LocalFileStorage`/`S3FileStorage` 구현
- `FileStorageService` 오케스트레이션 및 파일 검증(크기/확장자)
- `/api/files/upload` 엔드포인트 추가
- `UserService.signup` 업로드 경로를 신규 서비스로 전환
- AWS SDK 의존성 및 파일 저장 설정 추가

## SCOPE-OUT
- 기존 DB 데이터 마이그레이션
- CloudFront 연동
- 인증/인가 정책 변경

## TEST-CASES
- compile: `./gradlew compileJava`
- storage routing: local(`/uploads/...`) vs s3(`s3://...`) 라우팅 검증
- api: `/api/files/upload`, `/api/files/download`, `/api/files/delete` 동작 확인
- regression: 회원가입 업로드(`uploadFile`) 흐름 정상 확인

---

## PROPOSED-PLAN-2
- 목표: 업로드된 프로필 이미지 URL을 회원 DB에 업데이트하고, 해당 URL 기반 이미지를 화면에서 렌더링
- 범위:
  - `PUT /api/user/profile-image` 추가
  - `GET /api/files/view` 추가
  - `FinancePage` 사용자 아바타 표시/변경 UI 반영

## DECISIONS-2
- 프로필 이미지 변경은 multipart 직접 업로드 방식으로 처리
- 이미지 렌더링 URL은 `/api/files/view?fileUrl=...`로 통일
- 프론트 이미지 태그 로딩을 위해 `/api/files/view`는 `permitAll` 허용

## TEST-CASES-2
- API: `PUT /api/user/profile-image` 호출 시 `profile_image_url` 갱신 확인
- API: `GET /api/files/view` local/s3/legacy URL 출력 확인
- FE: FinancePage 헤더/드롭다운 아바타 출력 및 변경 요청 동작 확인
